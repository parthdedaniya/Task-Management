databases:
    - name: task-management-db
      databaseName: taskmanagement
      plan: free

services:
    # Backend API
    - type: web
      name: task-management-backend
      runtime: node
      plan: free
      rootDir: backend
      buildCommand: npm install
      startCommand: npm start
      envVars:
          - key: NODE_ENV
            value: production
          - key: PORT
            value: 10000
          - key: JWT_SECRET
            generateValue: true
          - key: DB_HOST
            fromDatabase:
                name: task-management-db
                property: host
          - key: DB_PORT
            fromDatabase:
                name: task-management-db
                property: port
          - key: DB_NAME
            fromDatabase:
                name: task-management-db
                property: database
          - key: DB_USER
            fromDatabase:
                name: task-management-db
                property: user
          - key: DB_PASSWORD
            fromDatabase:
                name: task-management-db
                property: password
          # CORS_ORIGIN will be set after frontend is deployed
          # Update this with your frontend URL after deployment
          # - key: CORS_ORIGIN
          #   value: https://your-frontend.onrender.com

    # Frontend Static Site
    - type: web
      name: task-management-frontend
      runtime: static
      rootDir: frontend
      buildCommand: npm run build
      staticPublishPath: dist
      envVars:
          - key: VITE_API_URL
            fromService:
                type: web
                name: task-management-backend
                property: host
                format: https://{{value}}/api
